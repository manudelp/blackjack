<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack</title>
    <link rel="icon" href="assets/img/icon.png">
    <link rel="stylesheet" href="css/style.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="table">
        <div class="deck"></div>

        <div class="hand dealer">
            <div class="card">
                <div class="number">A</div>
                <div class="suit">♥</div>
                <div class="number number--sideways">A</div>
            </div>
            <div class="card">
                <div class="number">K</div>
                <div class="suit">♦</div>
                <div class="number number--sideways">K</div>
            </div>
        </div>
        
        <div class="hand player">
            <div class="card">
                <div class="number">A</div>
                <div class="suit">♥</div>
                <div class="number number--sideways">A</div>
            </div>
            <div class="card">
                <div class="number">8</div>
                <div class="suit">♠</div>
                <div class="number number--sideways">8</div>
            </div>
            <div class="card passed">
                <div class="number">10</div>
                <div class="suit">♦</div>
                <div class="number number--sideways">10</div>
            </div>
        </div>

        <div class="table-bets">
            <div class="bet bet5"><p>5</p></div>
            <div class="bet bet10"><p>10</p></div>
            <div class="bet bet25"><p>25</p></div>
            <div class="bet bet50"><p>50</p></div>
            <div class="bet bet100"><p>100</p></div>
            <div class="bet bet500"><p>500</p></div>
        </div>
    </div>

    <div class="balance">
        <div class="current-balance">
            <h4>Balance</h4>
            <h2 class="balance-value"><div>$<span id="balance">0</span></div> <span class="currency">USD</span></h2>
            <button class="balance-button" id="addBalanceBtn" onclick="addBalance();">Add balance</button>
        </div>

        <div class="current-bet">
            <h4>Current bet</h4>
            <h2 class="current-bet-value"><div>$<span id="currentBet">0</span></div> <span class="currency">USD</span></h2>
        </div>
    </div>

    <div class="hand-value">
        <h2>Hand values</h2>
        <div class="values">
            <div class="dealer">
                <h4>Dealer</h4>
                <h2 id="dealer-value">0</h2>
            </div>
            <div class="player">
                <h4>Player</h4>
                <h2 id="player-value">0</h2>
            </div>
        </div>
    </div>

    <div class="bets" id="bets">
        <div class="sign" id="sign">
            <h2>Place your bets in order to play</h2>
        </div>

        <div class="betButtons">
            <button class="clearbet" id="clearBet">Clear Bet</button>
            <div class="betValues">
                <div class="preselected">
                    <button class="btn" id="bet5">5 <span>USD</span></button>
                    <button class="btn" id="bet10">10 <span>USD</span></button>
                    <button class="btn" id="bet25">25 <span>USD</span></button>
                    <button class="btn" id="bet50">50 <span>USD</span></button>
                    <button class="btn" id="bet100">100 <span>USD</span></button>
                    <button class="btn" id="bet500">500 <span>USD</span></button>
                </div>
                <div class="custom">
                    <input type="number" id="customBet" placeholder="Custom Bet">
                    <button class="btn" id="bet">Bet</button>
                </div>
            </div>
        </div>
    </div>

    <div class="actions">
        <button class="btn" id="hit">Hit</button>
        <button class="btn" id="stand">Stand</button>
    </div>
    
    <script>
        const MAX_BET = 3000;

        // Util function to add balance
        function addBalance() {
            // Ensure balanceAmount is a number
            const balanceAmount = parseInt(localStorage.getItem("balance")) || 0;
            const newBalance = balanceAmount + parseInt(prompt("Enter amount to add: "));
            localStorage.setItem("balance", newBalance);
            document.getElementById("balance").innerHTML = newBalance;
            return newBalance;
        }

        function placeBets(balance) {
            var bet5 = document.getElementById("bet5");
            var bet10 = document.getElementById("bet10");
            var bet25 = document.getElementById("bet25");
            var bet50 = document.getElementById("bet50");
            var bet100 = document.getElementById("bet100");
            var bet500 = document.getElementById("bet500");

            var currentBet = document.getElementById("currentBet");
            var betAmount = 0;

            function updateCurrentBet() {
                currentBet.innerHTML = betAmount;
            }

            var tableBets = document.querySelector(".table-bets");
            var tableBet5 = '<div class="bet bet5"><p>5</p></div>';
            var tableBet10 = '<div class="bet bet10"><p>10</p></div>';
            var tableBet25 = '<div class="bet bet25"><p>25</p></div>';
            var tableBet50 = '<div class="bet bet50"><p>50</p></div>';
            var tableBet100 = '<div class="bet bet100"><p>100</p></div>';
            var tableBet500 = '<div class="bet bet500"><p>500</p></div>';

            function clearTableBets() {
                tableBets.innerHTML = "";
            }

            function updateTableBets() {
                clearTableBets();
                
                var remainingBetAmount = betAmount;
            
                while (remainingBetAmount >= 500) {
                    tableBets.innerHTML += tableBet500;
                    remainingBetAmount -= 500;
                }
                while (remainingBetAmount >= 100) {
                    tableBets.innerHTML += tableBet100;
                    remainingBetAmount -= 100;
                }
                while (remainingBetAmount >= 50) {
                    tableBets.innerHTML += tableBet50;
                    remainingBetAmount -= 50;
                }
                while (remainingBetAmount >= 25) {
                    tableBets.innerHTML += tableBet25;
                    remainingBetAmount -= 25;
                }
                while (remainingBetAmount >= 10) {
                    tableBets.innerHTML += tableBet10;
                    remainingBetAmount -= 10;
                }
                while (remainingBetAmount >= 5) {
                    tableBets.innerHTML += tableBet5;
                    remainingBetAmount -= 5;
                }
            }

            var balance = document.getElementById("balance");
            var balanceAmount = parseInt(localStorage.getItem("balance")) || 0;
            var betAmount = 0;

            function updateBalance() {
                balance.innerHTML = balanceAmount - betAmount;
            }

            function updateCurrentBet() {
                currentBet.innerHTML = betAmount;
            }

            bet5.addEventListener("click", function() {
                if (balanceAmount >= 5 && betAmount + 5 <= balanceAmount && betAmount < MAX_BET) {
                    betAmount += 5;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            bet10.addEventListener("click", function() {
                if (balanceAmount >= 10 && betAmount + 10 <= balanceAmount && betAmount < MAX_BET) {
                    betAmount += 10;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            bet25.addEventListener("click", function() {
                if (balanceAmount >= 25 && betAmount + 25 <= balanceAmount && betAmount < MAX_BET) {
                    betAmount += 25;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            bet50.addEventListener("click", function() {
                if (balanceAmount >= 50 && betAmount + 50 <= balanceAmount && betAmount < MAX_BET) {
                    betAmount += 50;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            bet100.addEventListener("click", function() {
                if (balanceAmount >= 100 && betAmount + 100 <= balanceAmount && betAmount < MAX_BET) {
                    betAmount += 100;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            bet500.addEventListener("click", function() {
                if (balanceAmount >= 500 && betAmount + 500 <= balanceAmount && betAmount < MAX_BET) {
                    betAmount += 500;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            var clearBet = document.getElementById("clearBet");
            clearBet.addEventListener("click", function() {
                clearTableBets();
                betAmount = 0;
                updateBalance();
                updateCurrentBet();
            });

            customBet.addEventListener("click", function() {
                var customBetAmount = parseInt(customBet.value);
                if (balanceAmount >= customBetAmount && betAmount + customBetAmount <= balanceAmount && betAmount < MAX_BET) {
                    balanceAmount -= customBetAmount;
                    betAmount += customBetAmount;
                    updateBalance();
                    updateTableBets();
                    updateCurrentBet();
                }
            });

            var bet = document.getElementById("bet");
            bet.addEventListener("click", function() {
                if (betAmount > 0  && betAmount <= balanceAmount) {
                    playBlackjack();
                }
            });

        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function dealCard(deck) {
            return deck.pop();
        }


        function clearCards() {
            var playerHand = document.querySelector(".hand.player");
            var dealerHand = document.querySelector(".hand.dealer");

            playerHand.innerHTML = "";
            dealerHand.innerHTML = "";
        }

        function startGame() {
            clearCards();

            var betBlock = document.getElementById("bets");
            betBlock.style.pointerEvents = "none";
            betBlock.style.opacity = "0";

            var betButtons = document.querySelector(".betButtons");
            betButtons.style.pointerEvents = "none";
            betButtons.style.opacity = "0";
            betButtons.style.transform = "translateY(100%)";

            var betSign = document.getElementById("sign");
            betSign.style.opacity = "0";
            setTimeout(function() {
                betSign.style.display = "none";
            }, 500);

            var actions = document.querySelector(".actions");
            actions.style.opacity = "1";
            actions.style.transform = "translateY(0)";

            var handValues = document.querySelector(".hand-value");
            handValues.style.opacity = "1";
            handValues.style.pointerEvents = "auto";
        }

        function updateHandValue(hand, handValueElement) {
            var handValue = 0;
            var hasAce = false;

            hand.forEach(card => {
                if (card.value === 'J' || card.value === 'Q' || card.value === 'K') {
                    handValue += 10;
                } else if (card.value === 'A') {
                    hasAce = true;
                    handValue += 11;
                } else {
                    handValue += parseInt(card.value);
                }
            });

            if (hasAce && handValue > 21) {
                handValue -= 10;
            }
            
            handValueElement.innerHTML = handValue;
            return handValue;
        }


        placeBets(10000); //addBalance()

        function playBlackjack() {
            startGame();

            const deck = [
                { value: '2', suit: '♥' }, { value: '3', suit: '♥' }, { value: '4', suit: '♥' }, { value: '5', suit: '♥' },
                { value: '6', suit: '♥' }, { value: '7', suit: '♥' }, { value: '8', suit: '♥' }, { value: '9', suit: '♥' },
                { value: '10', suit: '♥' }, { value: 'J', suit: '♥' }, { value: 'Q', suit: '♥' }, { value: 'K', suit: '♥' },
                { value: 'A', suit: '♥' },
                { value: '2', suit: '♦' }, { value: '3', suit: '♦' }, { value: '4', suit: '♦' }, { value: '5', suit: '♦' },
                { value: '6', suit: '♦' }, { value: '7', suit: '♦' }, { value: '8', suit: '♦' }, { value: '9', suit: '♦' },
                { value: '10', suit: '♦' }, { value: 'J', suit: '♦' }, { value: 'Q', suit: '♦' }, { value: 'K', suit: '♦' },
                { value: 'A', suit: '♦' },
                { value: '2', suit: '♣' }, { value: '3', suit: '♣' }, { value: '4', suit: '♣' }, { value: '5', suit: '♣' },
                { value: '6', suit: '♣' }, { value: '7', suit: '♣' }, { value: '8', suit: '♣' }, { value: '9', suit: '♣' },
                { value: '10', suit: '♣' }, { value: 'J', suit: '♣' }, { value: 'Q', suit: '♣' }, { value: 'K', suit: '♣' },
                { value: 'A', suit: '♣' },
                { value: '2', suit: '♠' }, { value: '3', suit: '♠' }, { value: '4', suit: '♠' }, { value: '5', suit: '♠' },
                { value: '6', suit: '♠' }, { value: '7', suit: '♠' }, { value: '8', suit: '♠' }, { value: '9', suit: '♠' },
                { value: '10', suit: '♠' }, { value: 'J', suit: '♠' }, { value: 'Q', suit: '♠' }, { value: 'K', suit: '♠' },
                { value: 'A', suit: '♠' }
            ];
            shuffleDeck(deck);

            var playerHand = [];
            var playerHandElement = document.querySelector(".hand.player");

            function dealCardToPlayer() {
                var card = dealCard(deck);
                playerHand.push(card);

                var cardElement = document.createElement("div");
                cardElement.classList.add("card");
                cardElement.innerHTML = `
                    <div class="number">${card.value}</div>
                    <div class="suit">${card.suit}</div>
                    <div class="number number--sideways">${card.value}</div>
                `;
                playerHandElement.appendChild(cardElement);

                updateHandValue(playerHand, document.getElementById("player-value"));
            }

            dealCardToPlayer();
            
        }
    </script>

    <!-- <script src="js/main.js"></script> -->
</body>
</html>